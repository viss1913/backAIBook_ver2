# üöÄ –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã API (Update v2.0)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –≤ –±—ç–∫–µ–Ω–¥: –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–∞—Ä—Ç–∏–Ω–æ–∫ —Å –≤—ã–±–æ—Ä–æ–º –∫–∞—á–µ—Å—Ç–≤–∞ –∏ JIT-—Ä–µ—Ä–∞–π—Ç —Ç–µ–∫—Å—Ç–∞.

---

## 1. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–æ–∫ (–° –≤—ã–±–æ—Ä–æ–º –∫–∞—á–µ—Å—Ç–≤–∞)

–≠–Ω–¥–ø–æ–∏–Ω—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–ø–µ—Ä—å –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞: **–ë—ã—Å—Ç—Ä–æ/–î–æ—Ä–æ–≥–æ** (Turbo/Pro) –∏–ª–∏ **–ú–µ–¥–ª–µ–Ω–Ω–æ/–î–µ—à–µ–≤–æ** (Base/Schnell).

### Endpoint
`POST /api/generate-image`

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã (Query)
| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ | –¶–µ–Ω–∞ |
|:---|:---|:---|:---|
| `mode` | `turbo` | **(Default)** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª—å **FLUX 1.1 Pro**. –†–∞–∑–º–µ—Ä 512x512. –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ, –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ (~4 —Å–µ–∫). | **25 —Ç–æ–∫–µ–Ω–æ–≤** |
| `mode` | `base` | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª—å **FLUX Schnell**. –†–∞–∑–º–µ—Ä 1024x1024. –•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ, —á—É—Ç—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ (~10 —Å–µ–∫). | **5 —Ç–æ–∫–µ–Ω–æ–≤** |

### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ (Retrofit / OkHttp)
```http
POST /api/generate-image?mode=base
Content-Type: application/json

{
  "bookTitle": "War and Peace",
  "author": "Tolstoy",
  "textChunk": "The scene description...",
  "styleKey": "anime",
  "deviceId": "android_device_id_123"
}
```

### –û—Ç–≤–µ—Ç (200 OK)
```json
{
  "success": true,
  "imageUrl": "https://...",
  "promptUsed": "...",
  "tokenBalance": 975.50
}
```

---

## 2. JIT –†–µ—Ä–∞–π—Ç —Ç–µ–∫—Å—Ç–∞ (Zoomer Style)

–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç —Ç–µ–∫—Å—Ç–∞ –≤ —Å—Ç–∏–ª–µ "–ó—É–º–µ—Ä" (–∏–ª–∏ –¥—Ä—É–≥–∏—Ö, –µ—Å–ª–∏ –¥–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ).

### Endpoint
`POST /api/books/rewrite`

### –¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞ (Body)
```json
{
  "text": "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞? –Ø —Å–µ–≥–æ–¥–Ω—è –ø–æ—à–µ–ª –≤ –º–∞–≥–∞–∑–∏–Ω.",
  "style": "zoomer",
  "deviceId": "android_device_id_123"
}
```
*   `style` ‚Äî –ø–æ–∫–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–Ω–∞—á–µ–Ω–∏–µ `"zoomer"`.

### –û—Ç–≤–µ—Ç (200 OK)
```json
{
  "success": true,
  "data": {
    "original": "–ü—Ä–∏–≤–µ—Ç, –∫–∞–∫ –¥–µ–ª–∞?...",
    "rewritten": "–ô–æ, —á–µ –∫–∞–≤–æ? –Ø —Å–µ–¥–Ω—è –≤ –º–∞–≥–∞–∑ –≥–æ–Ω—è–ª, –∫—Ä–∏–Ω–∂ –ª–æ–≤–∏–ª.",
    "isCached": false,
    "tokensCost": 0.45
  },
  "balance": 975.05
}
```

### –û—à–∏–±–∫–∏
*   **402 Payment Required** ‚Äî –µ—Å–ª–∏ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:
    ```json
    {
      "success": false,
      "error": "Not enough tokens",
      "balance": 0.10
    }
    ```

---

## 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ –¢–æ–∫–µ–Ω–∞–º

*   –ë–∞–ª–∞–Ω—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Ç–µ–ø–µ—Ä—å **–¥—Ä–æ–±–Ω—ã–π** (–¥–æ —Å–æ—Ç—ã—Ö –¥–æ–ª–µ–π), —Ç–∞–∫ –∫–∞–∫ JIT-—Ä–µ—Ä–∞–π—Ç —Å–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–ø–µ–π–∫–∏.
*   –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å –±–∞–ª–∞–Ω—Å –≤ UI —Å –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ–º –¥–æ 2 –∑–Ω–∞–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `975.05 ‚ÇÆ`).
