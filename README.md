# Viss Reader Backend

Backend –¥–ª—è Android-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è AI Book Reader. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç AI-–∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è –∫–Ω–∏–≥ —á–µ—Ä–µ–∑ Gemini 2.0 Flash (–¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤) –∏ LaoZhang API (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π).

## üöÄ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Node.js 20+**
- **Express.js** - –≤–µ–±-—Å–µ—Ä–≤–µ—Ä
- **Google Gemini 2.0 Flash API** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–æ–≤ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- **LaoZhang API** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (FLUX, SeeDream, Nano Banana)
- **Joi** - –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- **CORS** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Node.js 20 –∏–ª–∏ –≤—ã—à–µ
- Google Gemini API –∫–ª—é—á (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤)
- LaoZhang API –∫–ª—é—á (–¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π)

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

1. –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
npm install
```

3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –Ω–∞ –æ—Å–Ω–æ–≤–µ `.env.example`:

```bash
cp .env.example .env
```

4. –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à–∏ API –∫–ª—é—á–∏ –≤ `.env`:

```
GEMINI_API_KEY=your_gemini_api_key_here
LAOZHANG_API_KEY=your_laozhang_api_key_here
```

## üèÉ –ó–∞–ø—É—Å–∫

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
npm run dev
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3000`

### Production

```bash
npm start
```

## üì° API Endpoints

### POST `/api/generate-image`

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç AI-–∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—é –¥–ª—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –∫–Ω–∏–≥–∏.

**Request Body:**
```json
{
  "bookTitle": "–í–æ–π–Ω–∞ –∏ –º–∏—Ä",
  "author": "–õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π",
  "textChunk": "–û–Ω —Å—Ç–æ—è–ª –Ω–∞ –±–∞–ª–∫–æ–Ω–µ, –≥–ª—è–¥—è –Ω–∞ –∑–∞–∫–∞—Ç..."
}
```

**Response (Success):**
```json
{
  "success": true,
  "imageUrl": "https://cdn.perplexity.ai/...",
  "promptUsed": "A detailed artistic illustration..."
}
```

**Response (Error):**
```json
{
  "success": false,
  "error": "Error message"
}
```

**Status Codes:**
- `200` - –£—Å–ø–µ—à–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
- `400` - –û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
- `429` - –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤
- `500` - –û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∏–ª–∏ API

### GET `/health`

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞.

**Response:**
```json
{
  "status": "ok",
  "timestamp": "2024-01-01T12:00:00.000Z"
}
```

## üöÇ –î–µ–ø–ª–æ–π –Ω–∞ Railway

1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ [Railway](https://railway.app)
2. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ –≤–∞—à GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–æ–¥
3. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
   - `GEMINI_API_KEY` - –≤–∞—à Google Gemini API –∫–ª—é—á
   - `LAOZHANG_API_KEY` - –≤–∞—à LaoZhang API –∫–ª—é—á
4. Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç Node.js –ø—Ä–æ–µ–∫—Ç –∏ –∑–∞–ø—É—Å—Ç–∏—Ç `npm start`

### Railway Configuration

Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –û–ø—Ä–µ–¥–µ–ª–∏—Ç Node.js –ø—Ä–æ–µ–∫—Ç
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`npm install`)
- –ó–∞–ø—É—Å—Ç–∏—Ç —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ `npm start`
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `PORT` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

## üìù –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

- `bookTitle`: —Å—Ç—Ä–æ–∫–∞, –º–∞–∫—Å–∏–º—É–º 100 —Å–∏–º–≤–æ–ª–æ–≤, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ
- `author`: —Å—Ç—Ä–æ–∫–∞, –º–∞–∫—Å–∏–º—É–º 50 —Å–∏–º–≤–æ–ª–æ–≤, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ
- `textChunk`: —Å—Ç—Ä–æ–∫–∞, –º–∞–∫—Å–∏–º—É–º 500 —Å–ª–æ–≤, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **Gemini API**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ–º–ø—Ç–æ–≤ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–µ–∫—Å—Ç–∞ –∏–∑ –∫–Ω–∏–≥–∏ (–º–æ–¥–µ–ª—å: gemini-2.0-flash-exp)
2. **LaoZhang API**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π. –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏:
   - `flux-kontext-pro` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ
   - `seedream-4.0` - BytePlus Ark SeeDream 4.0
   - `nano-banana-2` - Google Gemini powered
   - `gpt-image-1` - GPT-4o image generation
3. **Timeout**: –ó–∞–ø—Ä–æ—Å—ã –∫ API –∏–º–µ—é—Ç timeout 30 —Å–µ–∫—É–Ω–¥
4. **Rate Limits**: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ rate limiting (429)
5. **CORS**: –ù–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º (—Ä–∞–∑—Ä–µ—à–µ–Ω—ã –≤—Å–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏)
6. **–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏**: –ú–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –º–æ–¥–µ–ª—å —á–µ—Ä–µ–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä: `/api/generate-image?model=seedream-4.0`

## üêõ –û—Ç–ª–∞–¥–∫–∞

–õ–æ–≥–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ –∫–æ–Ω—Å–æ–ª—å. –î–ª—è –±–æ–ª–µ–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É —Ç–∏–ø–∞ `winston` –∏–ª–∏ `pino`.

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

ISC

