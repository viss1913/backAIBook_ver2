Ниже черновик ТЗ/документа для разработчика по **получению картинок по текстовому запросу через Perplexity API**.[1][2][3]

***

## 1. Назначение

Сделать HTTP‑запрос к Perplexity Chat Completions API, который по текстовому запросу пользователя возвращает ответ **плюс список картинок** (URL‑ы изображений), релевантных этому запросу.[2][1]

***

## 2. HTTP‑адрес и метод

- Метод: `POST`  
- URL: `https://api.perplexity.ai/chat/completions`[1][2]

***

## 3. Авторизация

- В заголовке:  
  - `Authorization: Bearer <API_KEY>` — ключ уже есть, подставляется из конфига/переменной окружения.[3][2][1]
- Дополнительные заголовки:  
  - `Content-Type: application/json`[2][1]

***

## 4. Тело запроса (JSON)

Базовая структура запроса для генерации текста + возврата картинок:[3][1][2]

```json
{
  "model": "sonar",              // либо актуальная модель Sonar из доки
  "return_images": true,         // ОБЯЗАТЕЛЬНО: включить возврат картинок
  "messages": [
    {
      "role": "user",
      "content": "Текстовый запрос пользователя, что нужно сгенерировать/показать на картинках"
    }
  ],
  "image_domain_filter": [],     // опционально: фильтр по доменам источников картинок
  "image_format_filter": []      // опционально: фильтр по форматам (jpg, png, gif, webp и т.п.)
}
```

Пояснения по полям:[1][2][3]

- `model` — одна из моделей семейства **Sonar**, которые поддерживают возврат медиа (уточнить по актуальной доке `Chat Completions` и `Returning Images with Sonar`).[2][1]
- `return_images: true` — ключевой флаг; без него картинки не вернутся.[3][1]
- `messages` — стандартный формат Chat Completions:
  - `role: "user"`  
  - `content`: текстовый промпт для генерации/подбора картинок.
- `image_domain_filter` (опционально):
  - массив строк с доменами, которые нужно **включить** или **исключить**;  
  - запись вида `"-gettyimages.com"` означает исключить картинки с этого домена.[1]
- `image_format_filter` (опционально):
  - массив строк с допустимыми форматами: `"jpg"`, `"png"`, `"gif"`, `"webp"` и т.д.[1]

Примеры вариантов фильтров (по доке `Returning Images with Sonar`):[1]

- Только GIF:  
  ```json
  "image_format_filter": ["gif"]
  ```
- Исключить Getty Images:  
  ```json
  "image_domain_filter": ["-gettyimages.com"]
  ```

***

## 5. Пример запроса (curl)

```bash
curl --request POST \
  --url https://api.perplexity.ai/chat/completions \
  --header "Authorization: Bearer ${PERPLEXITY_API_KEY}" \
  --header "Content-Type: application/json" \
  --data '{
    "model": "sonar",
    "return_images": true,
    "messages": [
      {
        "role": "user",
        "content": "Сгенерируй мне изображение современного финтех приложения в минималистичном стиле"
      }
    ],
    "image_format_filter": ["jpg", "png"]
  }'
```


***

## 6. Ответ сервера (общая структура)

Ответ — объект формата Chat Completions, в котором:[3][2]

- В `choices[0].message.content` — текстовый ответ.  
- Дополнительно присутствуют поля/структуры, содержащие список найденных/возвращённых картинок (URL‑ы, форматы и т.п.) — точное имя и структура уточняются по актуальной спецификации `Chat Completions` (раздел про media/images).[2][1]

Для реализации:

1. Спарсить JSON‑ответ.[2]
2. Забрать:
   - текст из `choices[0].message.content`;  
   - список картинок (URL/метаданные) из соответствующего поля в объекте ответа (смотреть в разделе **Response** эндпоинта `Chat Completions` и гайде `Returning Images with Sonar`).[1][7]
3. Вернуть в наше приложение:
   - текстовый комментарий модели;
   - массив картинок (URL, формат, возможно источник домена).[2][1]

***

## 7. Языки/SDK (по желанию)

В официальной доке есть SDK для Python и TypeScript/JavaScript, но можно работать и обычным HTTP.[4][1]

- Python: пакет `perplexityai`.[1]
- TypeScript/JS: `@perplexity-ai/perplexity_ai`.[10][1]

Если разработчик хочет — может использовать эти SDK, но ТЗ выше написано так, чтобы хватило обычного HTTP‑клиента.

***

Если нужно, можно дописать второй раздел про то, как это обернуть в твой бэкенд‑эндпоинт (например `POST /api/generate-image` в твоём сервисе) с точными полями входа/выхода.
