# –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## –ü–æ–ª–Ω—ã–π –ø–æ—Ç–æ–∫ –¥–ª—è Gen-API

```
üì± –§—Ä–æ–Ω—Ç–µ–Ω–¥ (Android)
  ‚Üì
POST /api/generate-image?provider=genapi
{
  "bookTitle": "–í–æ–π–Ω–∞ –∏ –º–∏—Ä",
  "author": "–õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π",
  "textChunk": "–û–Ω —Å—Ç–æ—è–ª –Ω–∞ –±–∞–ª–∫–æ–Ω–µ..."
}
  ‚Üì
üîß –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä (imageController.js)
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö ‚úÖ
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ API –∫–ª—é—á–µ–π ‚úÖ
  - –í—ã–∑–æ–≤ generateImageFromTextWithGenApi()
  ‚Üì
ü§ñ –®–∞–≥ 1: OpenRouter (Gemini 2.5-flash)
  - generatePromptForImage()
  - –ú–æ–¥–µ–ª—å: google/gemini-2.5-flash
  - –í—Ö–æ–¥: bookTitle, author, textChunk
  - –í—ã—Ö–æ–¥: –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ
  ‚Üì
üé® –®–∞–≥ 2: Gen-API (z-image)
  - generateImageWithGenApi()
  - –û—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–æ–º–ø—Ç–∞ –≤ Gen-API
  - –ü–æ–ª—É—á–µ–Ω–∏–µ request_id
  - –°–æ–∑–¥–∞–Ω–∏–µ Promise –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è callback
  ‚Üì
‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ callback (–¥–æ 5 –º–∏–Ω—É—Ç)
  - Gen-API –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
  - Callback –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ /api/gen-api-callback
  - handleGenApiCallback() –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
  - Promise —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —Å imageUrl
  ‚Üì
üì§ –û—Ç–≤–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É
{
  "success": true,
  "imageUrl": "data:image/png;base64,...",
  "promptUsed": "–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –æ—Ç Gemini"
}
```

## –î–µ—Ç–∞–ª–∏ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞

### –®–∞–≥ 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞ (OpenRouter/Gemini)

**–§—É–Ω–∫—Ü–∏—è:** `generatePromptForImage()`

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `bookTitle` - –ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏
- `author` - –ê–≤—Ç–æ—Ä
- `textChunk` - –§—Ä–∞–≥–º–µ–Ω—Ç —Ç–µ–∫—Å—Ç–∞

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –°–æ–∑–¥–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç: "–°–æ–∑–¥–∞–π –ø—Ä–æ–º–ø—Ç –¥–ª—è image generation..."
2. –°–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç —á–µ—Ä–µ–∑ `generateImagePrompt()` (—à–∞–±–ª–æ–Ω)
3. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ OpenRouter API (–º–æ–¥–µ–ª—å `google/gemini-2.5-flash`)
4. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ

**–í—ã—Ö–æ–¥:** –°—Ç—Ä–æ–∫–∞ —Å –ø—Ä–æ–º–ø—Ç–æ–º –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –®–∞–≥ 2: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (Gen-API)

**–§—É–Ω–∫—Ü–∏—è:** `generateImageWithGenApi()`

**–í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
- `prompt` - –ü—Ä–æ–º–ø—Ç –æ—Ç Gemini
- `callbackUrl` - URL –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –û—Ç–ø—Ä–∞–≤–∫–∞ POST –∑–∞–ø—Ä–æ—Å–∞ –≤ Gen-API `/networks/z-image`
2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - `prompt` - –ø—Ä–æ–º–ø—Ç –æ—Ç Gemini
   - `callback_url` - `https://backaibookver2-production.up.railway.app/api/gen-api-callback`
   - `acceleration: 'high'` - —É—Å–∫–æ—Ä–µ–Ω–∏–µ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   - `width: 992, height: 992`
   - `model: 'turbo'`
3. –ü–æ–ª—É—á–µ–Ω–∏–µ `request_id` –∏ —Å—Ç–∞—Ç—É—Å–∞ `"processing"`
4. –°–æ–∑–¥–∞–Ω–∏–µ Promise, –∫–æ—Ç–æ—Ä—ã–π –∂–¥–µ—Ç callback
5. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Promise –≤ `genApiRequests` Map –ø–æ `request_id`

**–í—ã—Ö–æ–¥:** Promise, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–∑—Ä–µ—à–∏—Ç—Å—è –∫–æ–≥–¥–∞ –ø—Ä–∏–¥–µ—Ç callback

### –®–∞–≥ 3: –û–±—Ä–∞–±–æ—Ç–∫–∞ callback

**–≠–Ω–¥–ø–æ–∏–Ω—Ç:** `POST /api/gen-api-callback`

**–§—É–Ω–∫—Ü–∏—è:** `handleGenApiCallback()`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. Gen-API –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –Ω–∞ callback URL
2. –í —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞:
   ```json
   {
     "request_id": 123,
     "status": "success",
     "output": {
       "image": "data:image/png;base64,..." // –∏–ª–∏ URL
     }
   }
   ```
3. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ `request_id` –∏–∑ callback
4. –ü–æ–∏—Å–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–≥–æ Promise –≤ `genApiRequests`
5. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ `output.image` –∏–ª–∏ `output.image_url`
6. –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ Promise —Å `imageUrl`
7. –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ `genApiRequests`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Promise –≤ `generateImageWithGenApi()` —Ä–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —Å `imageUrl`

### –®–∞–≥ 4: –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

**–§—É–Ω–∫—Ü–∏—è:** `generateImageFromTextWithGenApi()`

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—É—á–µ–Ω–∏–µ `imageUrl` –∏–∑ Promise
2. –í–æ–∑–≤—Ä–∞—Ç –æ–±—ä–µ–∫—Ç–∞:
   ```javascript
   {
     imageUrl: "data:image/png;base64,...",
     promptUsed: "–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –æ—Ç Gemini"
   }
   ```

**–ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä:**
- –ü–æ–ª—É—á–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç JSON –æ—Ç–≤–µ—Ç —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** Gen-API —Ä–∞–±–æ—Ç–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ callback
2. **–¢–∞–π–º–∞—É—Ç:** Promise –∂–¥–µ—Ç –¥–æ 5 –º–∏–Ω—É—Ç
3. **–•—Ä–∞–Ω–µ–Ω–∏–µ:** `genApiRequests` Map —Ö—Ä–∞–Ω–∏—Ç –æ–∂–∏–¥–∞—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã –≤ –ø–∞–º—è—Ç–∏
4. **–§–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:** Gen-API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç base64 data URL –∏–ª–∏ –ø—Ä—è–º–æ–π URL
5. **–£—Å–∫–æ—Ä–µ–Ω–∏–µ:** `acceleration: 'high'` —É—Å–∫–æ—Ä—è–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã

### GigaChat (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)
- –¢–æ—Ç –∂–µ –ø—Ä–æ—Ü–µ—Å—Å, –Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π (–±–µ–∑ callback)
- –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É

### GetImg (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)
- –¢–æ—Ç –∂–µ –ø—Ä–æ—Ü–µ—Å—Å, –Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π
- –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É

### LaoZhang (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π)
- –¢–æ—Ç –∂–µ –ø—Ä–æ—Ü–µ—Å—Å, –Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π
- –†–µ–∑—É–ª—å—Ç–∞—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å—Ä–∞–∑—É













