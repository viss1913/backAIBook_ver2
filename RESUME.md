# –†–µ–∑—é–º–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

### 1. –ü—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ GigaChat

**–ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª:**
```
–§—Ä–æ–Ω—Ç–µ–Ω–¥ ‚Üí –ë—ç–∫–µ–Ω–¥
  ‚Üì
OpenRouter (Gemini 2.5-flash) ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
  ‚Üì
GigaChat OAuth ‚Üí –ü–æ–ª—É—á–µ–Ω–∏–µ access_token
  ‚Üì
GigaChat API ‚Üí –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (function_call: auto)
  ‚Üì
GigaChat API ‚Üí –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ file_id
  ‚Üì
–ë—ç–∫–µ–Ω–¥ ‚Üí –§—Ä–æ–Ω—Ç–µ–Ω–¥ (base64 data URL)
```

### 2. –≠–Ω–¥–ø–æ–∏–Ω—Ç

**POST** `/api/generate-image?provider=gigachat`

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "bookTitle": "–í–æ–π–Ω–∞ –∏ –º–∏—Ä",
  "author": "–õ–µ–≤ –¢–æ–ª—Å—Ç–æ–π",
  "textChunk": "–û–Ω —Å—Ç–æ—è–ª –Ω–∞ –±–∞–ª–∫–æ–Ω–µ..."
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "imageUrl": "data:image/jpeg;base64,...",
  "promptUsed": "–¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –æ—Ç Gemini"
}
```

### 3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
GEMINI_API_KEY=sk-or-v1-... (OpenRouter –∫–ª—é—á)
GIGACHAT_AUTH_KEY=MDE5YjQxNWEtYTQzZS03MzE1LThjNzQtOWUxMDUwNzNmYjhiOjIyMDBkZjY1LTc2Y2MtNGNiNy05YTY0LWMwNDEzNDMwNWJkOQ==
GIGACHAT_CLIENT_ID=019b415a-a43e-7315-8c74-9e105073fb8b
GIGACHAT_SCOPE=GIGACHAT_API_PERS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

### 4. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

- ‚úÖ `getGigaChatAccessToken()` - –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ —á–µ—Ä–µ–∑ OAuth
- ‚úÖ `generateImageWithGigaChat()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ `downloadGigaChatImage()` - —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- ‚úÖ `generateImageFromTextWithGigaChat()` - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª
- ‚úÖ `generatePromptForImage()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞ —á–µ—Ä–µ–∑ Gemini

### 5. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è API –∫–ª—é—á–µ–π
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–∞–π–º–∞—É—Ç–æ–≤ (120 —Å–µ–∫—É–Ω–¥ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ OAuth
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

### 6. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- ‚úÖ –ü—Ä—è–º–æ–π —Ç–µ—Å—Ç —Ñ—É–Ω–∫—Ü–∏–π (test-direct-flow.js)
- ‚úÖ –¢–µ—Å—Ç —á–µ—Ä–µ–∑ —ç–Ω–¥–ø–æ–∏–Ω—Ç (test-gigachat-endpoint.js)
- ‚úÖ –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç–∞–µ—Ç (Gemini –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç —É—Å–ø–µ—à–Ω–æ)

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–¢–∞–π–º–∞—É—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏:** –£–≤–µ–ª–∏—á–µ–Ω –¥–æ 120 —Å–µ–∫—É–Ω–¥, —Ç–∞–∫ –∫–∞–∫ GigaChat –º–æ–∂–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–ª–≥–æ
2. **–ü—Ä–æ–º–ø—Ç:** Gemini –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º, –∑–∞—Ç–µ–º –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è "–ù–∞—Ä–∏—Å—É–π" –¥–ª—è GigaChat
3. **–§–æ—Ä–º–∞—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:** GigaChat –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JPEG, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ base64 data URL

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞. –î–ª—è —Ä–∞–±–æ—Ç—ã –Ω—É–∂–Ω–æ:
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ –Ω–∞ `/api/generate-image?provider=gigachat`


